{{ define "__subject" }}[{{ .Status | toUpper }}{{ if eq .Status "firing" }}:{{ .Alerts.Firing | len }}{{ end }}] {{ .GroupLabels.SortedPairs.Values | join " " }} {{ if gt (len .CommonLabels) (len .GroupLabels) }}({{ with .CommonLabels.Remove .GroupLabels.Names }}{{ .Values | join " " }}{{ end }}){{ end }}{{ end }}

{{ define "__description" }}{{ end }}

{{ define "__text_alert_list" }}{{ range . }}Labels:
{{ range .Labels.SortedPairs }} - {{ .Name }} = {{ .Value }}
{{ end }}Annotations:
{{ range .Annotations.SortedPairs }} - {{ .Name }} = {{ .Value }}
{{ end }}Source: {{ .GeneratorURL }}
{{ end }}{{ end }}

{{ define "__text_alerts_list" }}{{ if .Alerts.Firing }}Firing:
{{ template "__text_alert_list" .Alerts.Firing }}{{ end }}{{ if .Alerts.Resolved }}Resolved:
{{ template "__text_alert_list" .Alerts.Resolved }}{{ end }}{{ end }}

{{ define "email.default.subject" }}{{ template "__subject" . }}{{ end }}

{{ define "email.default.html" }}
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<style>
body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 20px;
    background-color: #f5f5f5;
}
.container {
    max-width: 800px;
    margin: 0 auto;
    background-color: white;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    overflow: hidden;
}
.header {
    padding: 20px;
    color: white;
    text-align: center;
}
.header.firing {
    background-color: #d32f2f;
}
.header.resolved {
    background-color: #388e3c;
}
.content {
    padding: 20px;
}
.alert {
    margin-bottom: 20px;
    padding: 15px;
    border-left: 4px solid #ddd;
    background-color: #f9f9f9;
}
.alert.critical {
    border-left-color: #d32f2f;
    background-color: #ffebee;
}
.alert.warning {
    border-left-color: #f57c00;
    background-color: #fff3e0;
}
.alert.info {
    border-left-color: #1976d2;
    background-color: #e3f2fd;
}
.alert-title {
    font-size: 18px;
    font-weight: bold;
    margin-bottom: 10px;
    color: #333;
}
.alert-description {
    margin-bottom: 15px;
    color: #666;
    line-height: 1.5;
}
.labels {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-bottom: 10px;
}
.label {
    background-color: #e0e0e0;
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 12px;
    font-family: monospace;
}
.timestamp {
    color: #999;
    font-size: 12px;
}
.actions {
    margin-top: 15px;
}
.btn {
    display: inline-block;
    padding: 8px 16px;
    margin-right: 10px;
    background-color: #1976d2;
    color: white;
    text-decoration: none;
    border-radius: 4px;
    font-size: 14px;
}
.btn:hover {
    background-color: #1565c0;
}
.footer {
    padding: 20px;
    background-color: #f5f5f5;
    text-align: center;
    color: #666;
    font-size: 12px;
}
</style>
</head>
<body>
<div class="container">
    <div class="header {{ .Status }}">
        <h1>{{ if eq .Status "firing" }}ðŸš¨ Alert Firing{{ else }}âœ… Alert Resolved{{ end }}</h1>
        <p>{{ .GroupLabels.alertname }} - {{ .GroupLabels.service }}</p>
    </div>
    
    <div class="content">
        {{ if .Alerts.Firing }}
        <h2>ðŸ”¥ Firing Alerts ({{ .Alerts.Firing | len }})</h2>
        {{ range .Alerts.Firing }}
        <div class="alert {{ .Labels.severity }}">
            <div class="alert-title">{{ .Annotations.summary }}</div>
            <div class="alert-description">{{ .Annotations.description }}</div>
            
            <div class="labels">
                {{ range .Labels.SortedPairs }}
                <span class="label">{{ .Name }}: {{ .Value }}</span>
                {{ end }}
            </div>
            
            <div class="timestamp">
                Started: {{ .StartsAt.Format "2006-01-02 15:04:05 UTC" }}
            </div>
            
            {{ if or .Annotations.runbook_url .Annotations.dashboard_url }}
            <div class="actions">
                {{ if .Annotations.runbook_url }}
                <a href="{{ .Annotations.runbook_url }}" class="btn">ðŸ“– Runbook</a>
                {{ end }}
                {{ if .Annotations.dashboard_url }}
                <a href="{{ .Annotations.dashboard_url }}" class="btn">ðŸ“Š Dashboard</a>
                {{ end }}
            </div>
            {{ end }}
        </div>
        {{ end }}
        {{ end }}
        
        {{ if .Alerts.Resolved }}
        <h2>âœ… Resolved Alerts ({{ .Alerts.Resolved | len }})</h2>
        {{ range .Alerts.Resolved }}
        <div class="alert">
            <div class="alert-title">{{ .Annotations.summary }}</div>
            <div class="alert-description">{{ .Annotations.description }}</div>
            
            <div class="labels">
                {{ range .Labels.SortedPairs }}
                <span class="label">{{ .Name }}: {{ .Value }}</span>
                {{ end }}
            </div>
            
            <div class="timestamp">
                Started: {{ .StartsAt.Format "2006-01-02 15:04:05 UTC" }}<br>
                Resolved: {{ .EndsAt.Format "2006-01-02 15:04:05 UTC" }}
            </div>
        </div>
        {{ end }}
        {{ end }}
    </div>
    
    <div class="footer">
        <p>Blog System Monitoring | Generated at {{ now.Format "2006-01-02 15:04:05 UTC" }}</p>
        <p>Cluster: {{ .CommonLabels.cluster }} | Environment: {{ .CommonLabels.environment }}</p>
    </div>
</div>
</body>
</html>
{{ end }}

{{ define "slack.default.title" }}{{ if eq .Status "firing" }}ðŸš¨{{ else }}âœ…{{ end }} {{ .GroupLabels.alertname }}{{ end }}

{{ define "slack.default.text" }}
{{ if eq .Status "firing" }}
*ðŸ”¥ Firing Alerts: {{ .Alerts.Firing | len }}*
{{ range .Alerts.Firing }}
*Alert:* {{ .Annotations.summary }}
*Description:* {{ .Annotations.description }}
*Severity:* {{ .Labels.severity }}
*Service:* {{ .Labels.service }}
*Instance:* {{ .Labels.instance }}
*Started:* {{ .StartsAt.Format "2006-01-02 15:04:05" }}
{{ if .Annotations.runbook_url }}*Runbook:* <{{ .Annotations.runbook_url }}|View Runbook>{{ end }}
{{ if .Annotations.dashboard_url }}*Dashboard:* <{{ .Annotations.dashboard_url }}|View Dashboard>{{ end }}
---
{{ end }}
{{ end }}

{{ if .Alerts.Resolved }}
*âœ… Resolved Alerts: {{ .Alerts.Resolved | len }}*
{{ range .Alerts.Resolved }}
*Alert:* {{ .Annotations.summary }}
*Service:* {{ .Labels.service }}
*Instance:* {{ .Labels.instance }}
*Duration:* {{ .StartsAt.Format "15:04" }} - {{ .EndsAt.Format "15:04" }}
---
{{ end }}
{{ end }}
{{ end }}

{{ define "pagerduty.default.description" }}{{ .GroupLabels.alertname }}: {{ .GroupLabels.service }}{{ end }}

{{ define "pagerduty.default.client" }}Blog System Alertmanager{{ end }}

{{ define "pagerduty.default.clientURL" }}{{ template "__alertmanagerURL" . }}{{ end }}

{{ define "pagerduty.default.severity" }}{{ if eq .GroupLabels.severity "critical" }}critical{{ else if eq .GroupLabels.severity "warning" }}warning{{ else }}info{{ end }}{{ end }}

{{ define "webhook.default.message" }}
{
  "status": "{{ .Status }}",
  "groupKey": "{{ .GroupKey }}",
  "groupLabels": {
    {{ range $k, $v := .GroupLabels }}
    "{{ $k }}": "{{ $v }}"{{ if ne $k (index $.GroupLabels.Names (sub (len $.GroupLabels.Names) 1)) }},{{ end }}
    {{ end }}
  },
  "commonLabels": {
    {{ range $k, $v := .CommonLabels }}
    "{{ $k }}": "{{ $v }}"{{ if ne $k (index $.CommonLabels.Names (sub (len $.CommonLabels.Names) 1)) }},{{ end }}
    {{ end }}
  },
  "commonAnnotations": {
    {{ range $k, $v := .CommonAnnotations }}
    "{{ $k }}": "{{ $v }}"{{ if ne $k (index $.CommonAnnotations.Names (sub (len $.CommonAnnotations.Names) 1)) }},{{ end }}
    {{ end }}
  },
  "externalURL": "{{ .ExternalURL }}",
  "alerts": [
    {{ range $i, $alert := .Alerts }}
    {
      "status": "{{ $alert.Status }}",
      "labels": {
        {{ range $k, $v := $alert.Labels }}
        "{{ $k }}": "{{ $v }}"{{ if ne $k (index $alert.Labels.Names (sub (len $alert.Labels.Names) 1)) }},{{ end }}
        {{ end }}
      },
      "annotations": {
        {{ range $k, $v := $alert.Annotations }}
        "{{ $k }}": "{{ $v }}"{{ if ne $k (index $alert.Annotations.Names (sub (len $alert.Annotations.Names) 1)) }},{{ end }}
        {{ end }}
      },
      "startsAt": "{{ $alert.StartsAt.Format "2006-01-02T15:04:05.000Z" }}",
      "endsAt": "{{ $alert.EndsAt.Format "2006-01-02T15:04:05.000Z" }}",
      "generatorURL": "{{ $alert.GeneratorURL }}",
      "fingerprint": "{{ $alert.Fingerprint }}"
    }{{ if ne $i (sub (len $.Alerts) 1) }},{{ end }}
    {{ end }}
  ]
}
{{ end }}

{{ define "teams.default.title" }}{{ if eq .Status "firing" }}ðŸš¨ Alert Firing{{ else }}âœ… Alert Resolved{{ end }}{{ end }}

{{ define "teams.default.text" }}
**{{ .GroupLabels.alertname }}** - {{ .GroupLabels.service }}

{{ if .Alerts.Firing }}
**ðŸ”¥ Firing Alerts ({{ .Alerts.Firing | len }}):**
{{ range .Alerts.Firing }}
- **{{ .Annotations.summary }}**
  - Description: {{ .Annotations.description }}
  - Severity: {{ .Labels.severity }}
  - Service: {{ .Labels.service }}
  - Instance: {{ .Labels.instance }}
  - Started: {{ .StartsAt.Format "2006-01-02 15:04:05" }}
{{ end }}
{{ end }}

{{ if .Alerts.Resolved }}
**âœ… Resolved Alerts ({{ .Alerts.Resolved | len }}):**
{{ range .Alerts.Resolved }}
- **{{ .Annotations.summary }}**
  - Service: {{ .Labels.service }}
  - Instance: {{ .Labels.instance }}
  - Duration: {{ .StartsAt.Format "15:04" }} - {{ .EndsAt.Format "15:04" }}
{{ end }}
{{ end }}

Cluster: {{ .CommonLabels.cluster }} | Environment: {{ .CommonLabels.environment }}
{{ end }}

{{ define "discord.default.title" }}{{ if eq .Status "firing" }}ðŸš¨{{ else }}âœ…{{ end }} {{ .GroupLabels.alertname }}{{ end }}

{{ define "discord.default.description" }}
{{ if eq .Status "firing" }}
**ðŸ”¥ Firing Alerts: {{ .Alerts.Firing | len }}**
{{ range .Alerts.Firing }}
**{{ .Annotations.summary }}**
{{ .Annotations.description }}

**Labels:**
{{ range .Labels.SortedPairs }}- {{ .Name }}: `{{ .Value }}`
{{ end }}
**Started:** {{ .StartsAt.Format "2006-01-02 15:04:05" }}
{{ if .Annotations.runbook_url }}**Runbook:** [View Runbook]({{ .Annotations.runbook_url }}){{ end }}
{{ if .Annotations.dashboard_url }}**Dashboard:** [View Dashboard]({{ .Annotations.dashboard_url }}){{ end }}
---
{{ end }}
{{ end }}

{{ if .Alerts.Resolved }}
**âœ… Resolved Alerts: {{ .Alerts.Resolved | len }}**
{{ range .Alerts.Resolved }}
**{{ .Annotations.summary }}**
**Service:** {{ .Labels.service }}
**Duration:** {{ .StartsAt.Format "15:04" }} - {{ .EndsAt.Format "15:04" }}
---
{{ end }}
{{ end }}
{{ end }}